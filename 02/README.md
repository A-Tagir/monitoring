# Домашнее задание к занятию «Системы мониторинга»

## Задание 1

* Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые      сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

* Ответ:
  
  Здесь нужны будут следующие метрики:

  - Свободное место на диске:   если диск заполнится отчетами или логами то система перестанет быть доступной.
  
  - Число запросов/ответов http (успешных 2-- /с ошибкой (коды ошибок 4--, 5--)):   Если число ответов с ошибкой выше заданного в SLA значит нужно вмешательство

  - Загрузка CPU :   Слишком высокая загрузка CPU может указывать на медленную работу и проблемы с ПО (необходима вмешательство - оптимизировать ПО или масштабировать платформу)
  
  - Загрузка оперативной памяти: Слишком маленькое количество свободного RAM указывает на неоптимальную работу ПО. Необходимо либо увеличивать RAM либо оптимизировать ПО.

  - Inodes/Files number: хотя число возможных inodes обычно велико и достаточно для большинства задач, однако, некоторые системы виртуализации позволяют ставить лимиты
    на эти параметры. Поэтому, особенно, если отчеты сохраняются на диск (в БД или как отдельные файлы?) то эти параметры лучше отслеживать. Если превысят предел то система перестанет быть доступной с признаками нехватки места на диске.
  
## Задание 2

* Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

Ответ:
  
- Менеджеру продукта необходимо объяснить:
  1. Обязанности перед клиентами описываются в соглашении об SLA (соглашение об уровне обслуживания)
  2. В SLA должны быть прописаны SLO (цель уровня обслуживания) — это соглашение в рамках SLA о конкретном показателе, например о времени безотказной работы или времени реагирования.
  3. Индикатор уровня обслуживания (SLI) измеряет соответствие цели уровня обслуживания (SLO)
   Соответственно, если SLI выше или равен SLO, то компания выполняет свои обязанности перед клиентом в полной мере.

  Нужно также объяснить, что если метрики RAM/inodes/CPUla выйдут за критические границы, то это вызовет отказ в обслуживании
  и отрицательно повлияет на SLI. Поэтому, эти метрики так важно отслеживать.

## Задание 3

* Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

Ответ:

- В данном случае необходимо организовать сбор логов приложений бесплатными системами, например, можно использовать Graylog, Grafana Loki или ELK-стек (ElasticSearch + Logstash + Kibana).
Выбор системы согласно требованиям и имеющемуся опыту разработчиков. Например, важное отличие и достоинство Graylog Open перед ELK-стеком - наличие встроенной системы оповещений (алертов) при возникновении каких-либо специфических ситуации или событий в процессе сбора логов (в ELK система оповещений есть, но она - платная, хотя есть и бесплатные сторонние плагины с подобным функционалом). Grafana Loki отличается от других систем простой и тем, что позволяет лучше балансировать стоимость системы Grafana Loki в соответствии с требованиями по скорости обработки и объёму данных, поскольку в ней нет полнотекстового поиска и, соответственно, меньше требования к оперативной памяти.

- В случае отсутствия бюджета на построение системы сбора логов, но делать это все равно нужно, то, возможно, стоит обратить внимание
  на Grafana Loki, так как она легковесная и относительно простая.

## Задание 4

* Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Ответ:

- В данном случае, нужно проверить ответы с информационными кодами 1XX (например, 102 Processing "запрос принят, но на его обработку понадобится длительное время") или с кодами "Перенаправление" 3ХX (301 редирект с http на https или другие).
  Далее действовать по ситуации. Например, если 102 Processing вызван медленной работой системы, то принять меры. В случае, если это нормальное поведение системы и время ответа соответсвует SLA, следует учитывать эти ответы как легитимные и внести в формулу расчета SLA.

## Задание 5

* Опишите основные плюсы и минусы pull и push систем мониторинга.

Ответ:

- PUSH-модель, это когда данные передаются агентами с рабочих машин в систему мониторинга через вспомогательные службы.
  
  Плюсами является 
  
  1. Упрощение репликации данных в разные системы мониторинга или реплики.
  2. Более гибкая настройка отправки пакетов с метриками
  3. Возможность испрользования протокола UDP, что дает большую производительность сбора метрик.
  4. Удобно, если машины с агентами часто меняют конфигурацию, IP адреса.
  
  Минусы
  
  1. Сложности отправки данных в разные системы
  2. UDP не гарантирует доставку пакетов
  3. При сбое агента данные не будут отправлятся и центральный узел не узнает об ошибке.
  4. Каждый агент нужно настраивать.
  5. Нужно проверять подлинность каждого агента.


- PULL-модель, это когда система мониторинга последовательно или параллельно собирает накопленную информацию с агентов.
- 
  Плюсами является

  1. Легче контролировать подлинность данных
  2. можно настроить единый proxy server до всех агентов с TLS
  3. упрощённая отладка получения данных с агентов
  4. легко определяется, что машина перестала отвечать

  Минусы:
  
  1. Возможны проблемы с доступностью за NAT

## Задание 6

* Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

Prometheus       - Работает в соответствии с  pull-моделью

TICK             - Работает в соответствии с  push-моделью

Zabbix           - Работает в соответствии с push- и pull-моделью

VictoriaMetrics  - Работает в соответствии с push- и pull-моделью

Nagios           - Работает в соответствии с  pull-моделью


## Задание 7

* Клонирую репозиторий

git clone https://github.com/influxdata/sandbox.git

* Папкам задаю нужные для запуска права

 sudo chmod -R 0777 kapacitor/

 sudo chmod -R 0777 telegraf/

* Запускаю

./sandbox up


![tick is up](https://github.com/A-Tagir/monitoring/blob/main/02/CICD_Monitoring_tick_up.png)


![chronograf](https://github.com/A-Tagir/monitoring/blob/main/02/CICD_Monitoring_chronograf.png)


## Задание 8

![cpu_usage](https://github.com/A-Tagir/monitoring/blob/main/02/CICD_Monitoring_cpu_usage.png)

## Задание 9

* Добавляю в конфиг изменения согдасно заданию и проверяю:

![measurements_docker](https://github.com/A-Tagir/monitoring/blob/main/02/CICD_Monitoring_measurements_docker.png)






  



